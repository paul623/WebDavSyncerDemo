# WDSyncer

åŸºäºWebDavçš„å®‰å“å°è£…åº“

[![](https://img.shields.io/badge/license-Apache%202-blue.svg)](https://www.apache.org/licenses/LICENSE-2.0)
[![](https://jitpack.io/v/paul623/WebDavSyncerDemo.svg)](https://bintray.com/beta/#/paul623/maven/wdsyncer?tab=overview)  [![](https://img.shields.io/badge/dynamic/json?labelColor=11ab60&color=282c34&label=%E9%85%B7%E5%AE%89%20Coolapk&suffix=%20fans&query=%24.data.totalSubs&url=https%3A%2F%2Fapi.spencerwoo.com%2Fsubstats%2F%3Fsource%3Dcoolapk%26queryKey%3D1258736&logo=data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iNjQiIGhlaWdodD0iNjQiPjxkZWZzPjxzdHlsZS8+PC9kZWZzPjxwYXRoIGQ9Ik0xMjcuODkzIDQyNi42NjdjMjkuOTItNjYuOTg3IDk0LjUwNy0xMTYuNjk0IDE2Ni40LTEzMC4zNDcgNTUuNzg3LTkuNiAxMTIuOTYgNS4wNjcgMTYxLjkyIDMxLjk0N0M0OTcuNzYgMzQ5LjQ0IDUzNC40IDM3OC44OCA1NjcuOTQ3IDQxMS4wNGMtMTYuMTYgMTguNC0zOS4wOTQgMjguODUzLTU3LjQ5NCA0NC43NDctNDYuMTMzLTM4Ljg4LTk2LjY0LTc3LjcwNy0xNTcuOTczLTg3LjA5NC03OC45MzMtMTMuMTczLTE1OC41NiA0OS4yMjctMTcwLjUwNyAxMjcuMTQ3LTguNjkzIDQ1LjkyIDEwLjEzNCA5NC42NjcgNDUuMTc0IDEyNC45MDcgMzkuNjggMzQuOTg2IDk3LjIyNiA0NC41ODYgMTQ3LjYyNiAzMS4yNTMgNTcuNi0xMy45MiAxMDEuOTc0LTU3LjA2NyAxMzYuODU0LTEwMi43NzMgNTQuMDgtNzIuMTA3IDk5LjItMTUwLjQgMTQ3Ljg0LTIyNi4xMzQgMTMuOTItMTkuMTQ2IDQ3LjQxMy0xNy4yMjYgNTguNzIgMy44NCA2My42MjYgMTA5LjAxNCAxMjYuMDggMjE4LjcyIDE4OS42IDMyNy43ODcgNy41NzMgMTUuMDkzIDQuNDI2IDM1Ljc4Ny05LjYgNDYuMTMzLTEzLjA2NyAxMC42MTQtMzMuMzM0IDEwLjI0LTQ2LjEzNC0uNjkzYTk3MDY2LjU1OCA5NzA2Ni41NTggMCAwMS0yMjYuMTg2LTE2Mi43MmMxOC44OC0xNS4wNCAzOC40LTI5LjMzMyA1Ny45NzMtNDMuNDY3IDIzLjczMyAxMi45MDcgNDMuNzg3IDMzLjE3NCA2OS42IDQxLjY1NC0yMC4zNzMtMzkuNTc0LTQzLjYyNy03Ny43MDctNjYuMzQ3LTExNS45NDctNDIuNjY2IDU5LjE0Ny03Ny4wNjYgMTI0LjIxMy0xMjMuMTQ2IDE4MS4wNjdDNTE2IDY2My40NjcgNDQ4LjggNzE2Ljk2IDM2OC42NCA3MjguNDhjLTM4Ljg4IDMuNDEzLTc5LjMwNyA0LjIxMy0xMTYuMzczLTkuOTczLTUzLjQ5NC0xOS4xNDctMTAwLjMyLTU4LjcyLTEyNC41ODctMTEwLjU2LTI4LjIxMy01Ni4xMDctMjYuNzczLTEyNS4wMTQuMjEzLTE4MS4yOHoiIGZpbGw9IiNmZmYiLz48L3N2Zz4=&longCache=true)](http://www.coolapk.com/u/1258736) [![](https://img.shields.io/badge/dynamic/json?color=282c34&labelColor=0084ff&label=%E7%9F%A5%E4%B9%8E%E5%85%B3%E6%B3%A8&query=%24.data.totalSubs&url=https%3A%2F%2Fapi.spencerwoo.com%2Fsubstats%2F%3Fsource%3Dzhihu%26queryKey%3Dzhu-bao-luo-29&longCache=true)](https://www.zhihu.com/people/zhu-bao-luo-29)



åŸåšå®¢ï¼š[WebDav for Android](https://www.cnblogs.com/robotpaul/p/12005045.html)

## ç¢ç¢å¿µ

ä¸ºå•¥è¦å†™è¿™ä¸ªåº“å‘¢ï¼Ÿ

* å°è¯•è‡ªå·±å†™ä¸€ä¸ªåº“è°ƒç”¨ï¼Œå­¦ä¹ ä¸€ä¸‹è¿™ä¸ªæµç¨‹ï¼Œä¸ºä»¥ååšå‡†å¤‡
* WebDavåŒæ­¥è¿‡ç¨‹å¾ˆç¹ç
* è‡ªå·±åšçš„é¡¹ç›®éƒ½ä¼šæ¶‰åŠåˆ°åŒæ­¥åŠŸèƒ½ï¼Œä¸æƒ³é‡å¤å†™ä»£ç 

## æ›´æ–°æ—¥å¿—

```java
2022.01.14 0.0.5
æœ¬ç‰ˆæœ¬æ²¡æœ‰æ–°å¢å†…å®¹
è¿ç§»åº“è‡³JitPack
2021.02.01 0.0.4
æ–°å¢æ”¯æŒè‡ªå®šä¹‰åŠ å¯†è§£å¯†æ–¹å¼
2020.08.24 0.0.3
ä¿®å¤äº†æŸ¥çœ‹è·¯å¾„æ–‡ä»¶æœåŠ¡å™¨åœ°å€ä¸ç”Ÿæ•ˆçš„é—®é¢˜
è°ƒæ•´äº†Demoä¸­çš„éƒ¨åˆ†é€»è¾‘
2020.08.22 0.0.2
ä¿®å¤ä¸Šä¼ æ–‡ä»¶å¤±è´¥çš„é—®é¢˜
æ–°å¢cleanï¼Œå¯ä»¥æ¸…é™¤æœ¬åœ°è´¦æˆ·äº†

ä¸‹æ¬¡æ›´æ–°ï¼šå¢åŠ å¤§æ–‡ä»¶ä¸Šä¼ æ”¯æŒã€ä¸Šä¼ è¿›åº¦å›è°ƒ
```

## å®‰å…¨æ€§

* å¯¹äºè´¦æˆ·å’Œå¯†ç åšäº†åŠ å¯†å¤„ç†
* æ”¯æŒè‡ªå®šä¹‰åŠ å¯†æ–¹å¼

## é£Ÿç”¨æ–¹æ³•
åœ¨é¡¹ç›®ä¸­å¼•ç”¨å³å¯
æœ€æ–°ç‰ˆæœ¬ï¼š[![](https://jitpack.io/v/paul623/WebDavSyncerDemo.svg)](https://bintray.com/beta/#/paul623/maven/wdsyncer?tab=overview) 
Add it in your root build.gradle at the end of repositories:
```groovy
allprojects {
		repositories {
			...
			maven { url 'https://jitpack.io' }
		}
	}
 ```
```groovy
dependencies {
	        implementation 'com.github.paul623:WebDavSyncerDemo:0.0.5'
	}
```

## ä½¿ç”¨æ•™ç¨‹

### Apiæ¥å£

```java
  /**
     * ä¸Šä¼ æ–‡ä»¶
     * @param fileName æ–‡ä»¶å åŒ…å«åç¼€å
     * @param fileLoc æ–‡ä»¶ç›®å½• å¦‚ï¼šhomeLoc/
     * @param listener è¿”å›ä¿¡æ¯ä¸º æ–‡ä»¶è·¯å¾„ï¼Œä¸Šä¼ æˆåŠŸ
     * */
    public void uploadFile(String fileName, String fileLoc, File f, OnSyncResultListener listener);
    /**
     * ä¸Šä¼ Stringç±»å‹æ•°æ®
     * ä½ å¯ä»¥ç›´æ¥æŠŠæ–‡ä»¶æ ¼å¼è®¾ç½®ä¸ºtxtå³å¯
     * @param fileName æ–‡ä»¶å åŒ…å«åç¼€å
     * @param fileLoc æ–‡ä»¶ç›®å½• å¦‚ï¼šhomeLoc/
     * @param listener è¿”å›ä¿¡æ¯ä¸º æ–‡ä»¶è·¯å¾„ï¼Œä¸Šä¼ æˆåŠŸ
     * */
    public void uploadString(String fileName, String fileLoc, String content, OnSyncResultListener listener);

   /**
    * ä¸‹è½½æ–‡ä»¶
    * @param listener è¿”å›çš„æ˜¯æ–‡ä»¶ä¿å­˜è·¯å¾„
    * é»˜è®¤ä¿å­˜è·¯å¾„åœ¨ï¼šåº”ç”¨çš„ç§æœ‰è·¯å¾„ä¸‹
    * */
    public void downloadFile(String fileName, String fileLoc, OnSyncResultListener listener);
    /**
     * ä¸‹è½½æ–‡ä»¶
     * @param listener è¿”å›çš„æ˜¯å†…å®¹
     * */
    public void downloadString(String fileName, String fileLoc, OnSyncResultListener listener);

    /**
     * åˆ—å‡ºæ‰€æœ‰æ–‡ä»¶ä¿¡æ¯
     * @param listFileListener å…·ä½“å‚çœ‹DavData
     * */
    public void listAllFile(String dir, OnListFileListener listFileListener);

    /**
     * åˆ é™¤æ–‡ä»¶
     * @param fileDir æ–‡ä»¶ç›®å½•
     * */
    public void deleteFile(String fileDir, OnSyncResultListener listener);
```

### ä½¿ç”¨ç¤ºä¾‹

#### 1.é…ç½®è´¦æˆ·ä¿¡æ¯

ä½¿ç”¨SyncConfigæ¥é…ç½®ä½ çš„è´¦æˆ·ã€å¯†ç ä»¥åŠæœåŠ¡å™¨åœ°å€ã€‚

é»˜è®¤æœåŠ¡å™¨åœ°å€ä¸ºåšæœäº‘ï¼Œå³æ‚¨å¯ä»¥ä¸è®¾ç½®ã€‚

```java
SyncConfig config=new SyncConfig(context);
config.setPassWord("ä½ çš„å¯†ç ");
config.setUserAccount("ä½ çš„è´¦æˆ·");
```

#### 2.é…ç½®åŠ å¯†è§£å¯†æ–¹å¼

ğŸ’¡0.0.4æ–°å¢

å¦‚éœ€è¦è‡ªå·±å®ç°åŠ å¯†è§£å¯†æ–¹å¼ï¼Œè¯·å®ç°Encryptionæ¥å£

```java
public interface Encryption {
    //åŠ å¯†
    public String encode(String key);
    //è§£å¯†
    public String decode(String password);
}
```

å¦‚

```java
public class ExampleEncryption implements Encryption {
    @Override
    public String encode(String key) {
        return key+"&";
    }

    @Override
    public String decode(String password) {
        return password.split("&")[0];
    }
}
```

åœ¨é…ç½®çš„æ—¶å€™ä½¿ç”¨

```java
 SyncConfig config=new SyncConfig(this,new DefaultEncryption());
```

åŒæ—¶ï¼Œå¯¹åº”çš„SyncManager

```java
 SyncManager syncManager=new SyncManager(this,new DefaultEncryption());
```

<u>**ç‰¹åˆ«æ³¨æ„ï¼šSyncConfigä¼ å…¥Encryptionåå¯¹åº”çš„SyncManagerå¿…é¡»ä¼ å…¥ç›¸åŒçš„Encryptionï¼Œå¦åˆ™ä¼šæŠ›å‡ºå¼‚å¸¸æˆ–è€…ç™»å½•å¤±è´¥ã€‚**</u>

#### 3.è°ƒç”¨å¹¶å®ç°å›è°ƒ

ç”±äºæ‰€æœ‰æ“ä½œéƒ½å¿…é¡»åœ¨çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œæ•…ä½ éœ€è¦è‡ªè¡Œå¤„ç†çº¿ç¨‹æ“ä½œï¼Œè¿™é‡Œä»¥ä¸Šä¼ ä¸ºä¾‹ã€‚

```java
 SyncManager syncManager=new SyncManager(MainActivity.this);
        syncManager.uploadString("test.txt", "WDSyncer", "å¦‚ä½ æ‰€è§ï¼ŒWebDavSyncerå·²ç»é…ç½®æˆåŠŸï¼", new OnSyncResultListener() {
            @Override
            public void onSuccess(String result) {
                //æˆåŠŸ
                Looper.prepare();
                Toast.makeText(MainActivity.this,result,Toast.LENGTH_SHORT).show();
                Looper.loop();
            }

            @Override
            public void onError(String errorMsg) {
                //å¤±è´¥
                Looper.prepare();
                Toast.makeText(MainActivity.this,errorMsg,Toast.LENGTH_SHORT).show();
                Looper.loop();
            }
        });
```

æˆ–è€…ä½ å¯ä»¥ä½¿ç”¨Handleræ¥æ§åˆ¶ã€‚

æ›´å¤šä¾‹å­è¯·æŸ¥çœ‹é¡¹ç›®ä»£ç ã€‚

æ–‡ä»¶ä¸Šä¼ ä¸‹è½½æˆ‘æ²¡æœ‰æµ‹è¯•ï¼Œå¦‚æœæœ‰é—®é¢˜è¯·åœ¨issueä¸­æäº¤å‘Šè¯‰æˆ‘

## å¸¸è§çš„å‡ºé”™ç±»å‹

1.è¯·æ±‚å¤±è´¥:å‡ºé”™äº†ï¼Œjavax.net.ssl.SSLHandshakeException: Chain validation failed

*è¿™ä¸ªä¸€èˆ¬æ˜¯æ‰‹æœºçš„æ—¶é—´ä¸å¯¹ï¼Œå¯¼è‡´æ¡æ‰‹å¤±è´¥ã€‚è¯·æ£€æŸ¥æ¨¡æ‹Ÿå™¨æˆ–è€…æ‰‹æœºçš„æ—¶é—´è®¾ç½®æ˜¯å¦å’Œå½“åœ°åœ°åŒºæ—¶é—´ç›¸åŒ*

2.è¯·æ±‚å¤±è´¥:å‡ºé”™äº†ï¼Œcom.thegrizzlylabs.sardineandroid.impl.SardineException: Error contacting https://dav.jianguoyun.com/dav/WDSyncer (401 )

*è¿™ä¸ªæ˜¯è´¦æˆ·ç”¨æˆ·åæˆ–è€…å¯†ç ä¸æ­£ç¡®*

3.Unable to start activity ComponentInfo{com.paul.webdavsyncerdemo/com.paul.webdavsyncerdemo.MainActivity}: java.lang.RuntimeException: è¯·é…ç½®Encryotion

*è¿™æ˜¯ç”±äºä½ åœ¨SyncConfigä¸­è®¾ç½®äº†Encryptionè€Œåœ¨SyncManagerä¸­æ²¡æœ‰è®¾ç½®*

4.java.lang.RuntimeException: Unable to start activity ComponentInfo{com.paul.webdavsyncerdemo/com.paul.webdavsyncerdemo.MainActivity}: java.lang.RuntimeException: Configä¸­æœªé…ç½®Encryotion

*è¿™æ˜¯ç”±äºä½ åœ¨SyncConfigæ²¡æœ‰é…ç½®Encryptionè€Œåœ¨SyncManagerä¸­è®¾ç½®äº†*

## å…¼å®¹æ€§

åœ¨å®‰å“PåŠä»¥ä¸Šç‰ˆæœ¬ä¸­ï¼Œè¯·åœ¨æ¸…å•ä¸­é…ç½®ï¼š

```xml
 android:usesCleartextTraffic="true"
```

## ç¬¬ä¸‰æ–¹ä¾èµ–

æœ¬é¡¹ç›®åŸºäº[sardine](https://github.com/thegrizzlylabs/sardine-android)

## å…³äº

@Paul623

Powered By å·´å¡ç½—é‚£çš„ä½™æ™–

åšå®¢ï¼šhttps://www.cnblogs.com/robotpaul/

## License

```
Copyright 2020 Paul623. https://github.com/paul623

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

   http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
 limitations under the License.
```

